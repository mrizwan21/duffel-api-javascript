<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Mapping Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .controls { background: #f5f5f5; padding: 15px; border-radius: 8px; display: flex; gap: 10px; align-items: center; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; flex-grow: 1; }
        button { padding: 8px 16px; background: #000; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #333; }
        #status { font-weight: bold; margin-left: 10px; font-size: 0.9em; }
        .status-connected { color: green; }
        .status-disconnected { color: red; }
        #events { border: 1px solid #eee; height: 400px; overflow-y: auto; padding: 10px; border-radius: 8px; background: #fafafa; }
        .event { padding: 10px; border-bottom: 1px solid #eee; background: #fff; margin-bottom: 5px; border-radius: 4px; font-size: 0.9em; }
        .event-time { color: #888; font-size: 0.8em; margin-bottom: 4px; }
        .tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
        .tag-resolved { background: #e6fffa; color: #047857; }
        .tag-info { background: #eff6ff; color: #1d4ed8; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Conflict Resolution Live Feed</h1>
    </div>

    <div class="controls">
        <input type="password" id="apiKey" placeholder="Enter API Key (default: dev_secret_key)" value="dev_secret_key">
        <button onclick="connect()">Connect</button>
        <span id="status" class="status-disconnected">Disconnected</span>
    </div>

    <h3>Live Events</h3>
    <div id="events"></div>

    <script>
        let ws;
        function connect() {
            const apiKey = document.getElementById('apiKey').value;
            const host = 'localhost:3000'; // Adjust if running elsewhere
            const url = `ws://${host}/ws/conflicts?apiKey=${apiKey}`;
            
            if (ws) ws.close();
            
            ws = new WebSocket(url);
            
            ws.onopen = () => {
                const status = document.getElementById('status');
                status.innerText = 'Connected';
                status.className = 'status-connected';
                logEvent('info', 'System', 'Connection established via WebSocket');
            };
            
            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                if (msg.type === 'conflict:resolved') {
                    const { id, entityId, fieldName, resolution } = msg.data;
                    logEvent('resolved', 'Conflict Resolved', `ID: ${id} | Entity: ${entityId} | Field: ${fieldName} | Strategy: ${resolution}`);
                } else {
                    logEvent('info', 'Info', msg.message);
                }
            };
            
            ws.onclose = () => {
                const status = document.getElementById('status');
                status.innerText = 'Disconnected';
                status.className = 'status-disconnected';
                logEvent('info', 'System', 'Connection closed');
            };
        }

        function logEvent(type, title, message) {
            const eventsDiv = document.getElementById('events');
            const div = document.createElement('div');
            div.className = 'event';
            const time = new Date().toLocaleTimeString();
            const tagClass = type === 'resolved' ? 'tag-resolved' : 'tag-info';
            
            div.innerHTML = `
                <div class="event-time">${time}</div>
                <div><span class="tag ${tagClass}">${title}</span> ${message}</div>
            `;
            eventsDiv.prepend(div);
        }
    </script>
</body>
</html>